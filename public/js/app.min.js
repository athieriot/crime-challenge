var socket=io.connect("/"),app=app||{},map=[],markers=[];$(function(){$(".usermap").each(function(i,element){GMaps.geocode({address:$(element).data("city"),callback:function(results,status){if("OK"==status){var latlng=results[0].geometry.location;map[$(element).data("id")]=new GMaps({div:$(element).attr("id"),lat:latlng.lat(),lng:latlng.lng(),zoom:1,width:"700px",height:"300px"})}}})}),socket.on("ping",function(data){$("#"+data._id).find(".alert").show(),$("#"+data._id).find(".points").text(data.points),window.setTimeout(function(){$("#"+data._id).find(".alert").hide()},1e3)}),socket.on("report",function(data){markers[data.user_id]||(markers[data.user_id]=[]),markers[data.user_id][data._id]=map[data.user_id].addMarker({lat:data.location.lat,lng:data.location.lng,title:data.type,infoWindow:{content:data.type},icon:"/img/gun.gif"})}),socket.on("solved",function(data){markers[data.user._id][data.crime._id].setIcon("/img/ok.png")})});